- hosts: cluster
  remote_user: root
  name: "Running cluster playbook"

  tasks:


tasks:
  - name: Check if openshift-ansible file exists
    stat:
      path: /root/release-3.11.zip
    register: stat_result

  - name: Download openshift-ansible 3.11
    shell: wget https://github.com/openshift/openshift-ansible/archive/release-3.11.zip
    when: stat_result.stat.exists == False

  #- name: Download ansible-2.8.5-1.el7.noarch.rpm
  #  shell: wget https://rpmfind.net/linux/epel/7/x86_64/Packages/a/ansible-2.8.5-1.el7.noarch.rpm

  - name: Install EPEL repo
    yum:
      name: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
      state: present


  - name: Install ansible
    shell: yum install -y ansible

  #- name: Copy inventory template to /etc/ansible/hosts
  #  shell: cat templates/openshift_inventory_file.template > /etc/ansible/hosts

  - name: example copying file with owner and permissions
    copy:
      src: ../templates/openshift_inventory_file.template
      dest: /etc/ansible/hosts
      owner: root
      group: root
      mode: 0644

  - name: Unzip openshift-ansible 3.11 at /root
    shell: unzip release-3.11.zip

  - name: Adjust file /root/openshift-ansible-release-3.11/roles/calico/tasks/certs.yml
    shell: sed -i 's/  become/  \#become/' /root/openshift-ansible-release-3.11/roles/calico/tasks/certs.yml

  - name: Run openshift prerequisites
    shell: ansible-playbook -i /etc/ansible/hosts /root/openshift-ansible-release-3.11/playbooks/prerequisites.yml